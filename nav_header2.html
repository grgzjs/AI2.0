<nav class="navbar navbar-expand-lg mai-sub-header" style="z-index: 0">
    <div class="container">
        <nav class="navbar navbar-expand-md">
            <button class="navbar-toggler hidden-md-up collapsed" type="button" data-toggle="collapse"
                data-target="#mai-navbar-collapse" aria-controls="mai-navbar-collapse" aria-expanded="false"
                aria-label="Toggle navigation"> <span
                    class="icon-bar"><span></span><span></span><span></span></span></button>

            <div class="navbar-collapse collapse mai-nav-tabs" id="mai-navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="nav-item parent open" id="home-tab">
                        <a class="nav-link" href="#" role="button" aria-expanded="false">
                            <span class="icon s7-home"></span>
                            <span>Home</span>
                        </a>
                        <ul class="mai-nav-tabs-sub mai-sub-nav nav">
                            <li class="nav-item">
                                <a class="nav-link" href="dashboard.php">
                                    <span class="icon s7-monitor"></span>
                                    <span class="name">Dashboard</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item parent" id="quote-tab">
                        <a class="nav-link" href="#" role="button" aria-expanded="false">
                            <span class="icon s7-paper-plane"></span>
                            <span>Cotización</span>
                        </a>
                        <ul class="mai-nav-tabs-sub mai-sub-nav nav">
                            <li class="nav-item">
                                <a class="nav-link" href="hello.php" id="quote-1">
                                    <span class="icon s7-science"></span>
                                    <span class="name">Cotizador</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="hellolist.php" id="quote-2">
                                    <span class="icon s7-albums"></span>
                                    <span class="name">Lista de
                                        Cotizaciones</span>
                                </a>
                            </li>

                        </ul>
                    </li>
                    <li class="nav-item parent" id="crm-tab">
                        <a class="nav-link" href="#" role="button" aria-expanded="false">
                            <span class="icon s7-users"></span>
                            <span>CRM</span>
                        </a>
                        <ul class="mai-nav-tabs-sub mai-sub-nav nav">
                            <li class="nav-item">
                                <a class="nav-link" href="crmregistro.php" id="crm-1">
                                    <span class="icon s7-user"></span>
                                    <span class="name">Registro</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="crm.php" id="crm-2">
                                    <span class="icon s7-id"></span>
                                    <span class="name">Lista de Contactos </span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item parent" id="ops-tab">
                        <a class="nav-link" href="#" role="button" aria-expanded="false">
                            <span class="icon s7-portfolio"></span>
                            <span>Operaciones</span>
                        </a>
                        <ul class="mai-nav-tabs-sub mai-sub-nav nav">
                            <li class="nav-item">
                                <a class="nav-link" href="opsmain.php" id="ops-1">
                                    <span class="icon s7-diamond"></span>
                                    <span class="name">Lista de Vuelos</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="ops_calendar.php" id="ops-2">
                                    <span class="icon s7-diamond"></span>
                                    <span class="name">Calendario</span>
                                </a>
                            </li>

                        </ul>
                    </li>
                    <li class="nav-item parent" id="accounting-tab">
                        <a class="nav-link" href="#" role="button" aria-expanded="false">
                            <span class="icon s7-piggy"></span>
                            <span>Contabilidad</span>
                        </a>
                        <ul class="mai-nav-tabs-sub mai-sub-nav nav">
                            <li class="nav-item">
                                <a class="nav-link" href="contabilidadgastos.php" id="accounting-1">
                                    <span class="icon s7-box2"></span>
                                    <span class="name">Gastos Generales</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="contabilidadingresos.php" id="accounting-2">
                                    <span class="icon s7-cash"></span>
                                    <span class="name">Ingresos Generales</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item parent" id="admin-tab">
                        <a class="nav-link" href="#" role="button" aria-expanded="false">
                            <span class="icon s7-display1"></span>
                            <span>Panel de Control</span>
                        </a>
                        <ul class="mai-nav-tabs-sub mai-sub-nav nav">
                            <li class="nav-item">
                                <a class="nav-link" href="admin_panel.php" id="admin-1">
                                    <span class="icon s7-box2"></span>
                                    <span class="name">Panel de Administración</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="aircraft_setup.php" id="admin-2">
                                    <span class="icon s7-plane"></span>
                                    <span class="name">Config. Aeronaves</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="company_setup.php" id="admin-3">
                                    <span class="icon s7-note2"></span>
                                    <span class="name">Config. Compañía</span>
                                </a>
                            </li> 
                            <li class="nav-item">
                                <a class="nav-link" href="airport_setup.php" id="admin-4">
                                    <span class="icon s7-note2"></span>
                                    <span class="name">Config. Aeropuertos</span>
                                </a>
                            </li> 
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
</nav>

<script>
    var hide_for_seller = [
        "ops-1",
        // "crm-3",
        "admin-tab",
        "accounting-tab"
    ];
    var hide_for_dispatcher = [
        "ops-2",
        // "crm-3",
        "admin-tab",
        "accounting-tab"
    ];
    var hide_for_unset = [
        "quote-tab",
        "crm-tab",
        "ops-tab",
        "admin-tab",
        "accounting-tab",
    ];
    var hide_for_owner = [
        "quote-tab",
        "crm-tab",
        // "crm-1",
        // "crm-2",
        "admin-1",
        "admin-4",
        // "ops-tab",
        "ops-1",
        "accounting-tab",
    ];

    function check_tabs(reload_tabs = false) {
        var hide_list = [];
        var usertype_in_storage = localStorage.getItem("user_type");

        switch (usertype_in_storage) {
            case "admin":
                // do not hide anything
                hide_list = []
                break;
            case "sales":
                hide_list = hide_for_seller;
                break;
            case "dispatch":
                hide_list = hide_for_dispatcher;
                break;
            case "owner":
                hide_list = hide_for_owner;
                break;
            default:
                // hide everything (but the dashboard)
                hide_list = hide_for_unset;
                break;
        }

        console.log("usertype_in_storage: " + usertype_in_storage);
        console.log("hide_list: " + hide_list);

        if (reload_tabs) {
            let tabs = document.getElementsByClassName("nav-item parent");
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].style.display = "block";   
            }

            let tab_elements = document.getElementsByClassName("nav-link");
            for (let i = 0; i < tab_elements.length; i++) {
                tab_elements[i].style.display = "block";   
            }
        }

        hide_list.forEach(hide_element => {
            document.getElementById(hide_element).style.display = "none";
        });

        // set which tab should be open currently

        home = ["dashboard.php"];
        quote = ["hello.php", "hellolist.php"];
        crm = ["crmregistro.php", "crm.php"];
        ops = ["opsmain.php", "opsmain2.php", "opsmain3.php", "ops_calendar.php"];
        accounting = ["contabilidadgastos.php", "contabilidadingresos.php", "contabilidadinvoicec.php"]
        admin = ["admin_panel.php", "aircraft_setup.php", "company_setup.php", "airport_setup.php"];

        if (document.getElementsByClassName("open")[0])
            document.getElementsByClassName("open")[0].classList.remove("open");

        let current_page = location.pathname.substring(13);
        console.log(current_page);
        if (home.includes(current_page)) {
            console.log("home-tab opened")
            document.getElementById("home-tab").classList.add("open");
        }
        else if (quote.includes(current_page)) {
            console.log("quote-tab opened")
            document.getElementById("quote-tab").classList.add("open");
        }
        else if (crm.includes(current_page)) {
            document.getElementById("crm-tab").classList.add("open");
        }
        else if (ops.includes(current_page)) {
            document.getElementById("ops-tab").classList.add("open");
        }
        else if (accounting.includes(current_page)) {
            document.getElementById("accounting-tab").classList.add("open");
        }
        else if (admin.includes(current_page)) {
            document.getElementById("admin-tab").classList.add("open");
        }
    }

    check_tabs();
</script>